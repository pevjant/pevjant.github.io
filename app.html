<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Image Composer</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overscroll-behavior: none;
        }
        body.crop-editing {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        .crop-area {
            position: absolute;
            border: 2px solid #4A90E2;
            background: rgba(74, 144, 226, 0.1);
            cursor: move;
            touch-action: none;
        }
        .resize-handle {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #4A90E2;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            touch-action: none;
        }
        .handle-nw { top: -20px; left: -20px; cursor: nwse-resize; }
        .handle-ne { top: -20px; right: -20px; cursor: nesw-resize; }
        .handle-sw { bottom: -20px; left: -20px; cursor: nesw-resize; }
        .handle-se { bottom: -20px; right: -20px; cursor: nwse-resize; }
        .crop-container {
            touch-action: none;
            overflow: hidden;
        }
        #cropEditor {
            max-height: 80vh;
            overflow-y: auto;
        }
        .image-card {
            transition: transform 0.1s;
        }
        .image-card:active {
            transform: scale(0.95);
        }
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Ïï± Ïª®ÌÖåÏù¥ÎÑà -->
    <div id="app" class="max-w-2xl mx-auto bg-white min-h-screen shadow-lg">
        <!-- Ìó§Îçî -->
        <header class="bg-blue-500 text-white p-4 sticky top-0 z-50 shadow">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold">‚úÇÔ∏è Image Composer</h1>
                    <p class="text-sm opacity-90">Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠ & Ìï©ÏÑ±</p>
                </div>
                <div class="text-xs opacity-75">v1.0.1</div>
            </div>
        </header>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <main class="pb-20">
            <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
            <nav class="flex border-b sticky top-16 bg-white z-40">
                <button onclick="switchTab('input')" id="tab-input" class="flex-1 py-3 font-medium border-b-2 border-blue-500 text-blue-500">
                    Ïù¥ÎØ∏ÏßÄ
                </button>
                <button onclick="switchTab('edit')" id="tab-edit" class="flex-1 py-3 font-medium border-b-2 border-transparent text-gray-500">
                    Ìé∏Ïßë
                </button>
                <button onclick="switchTab('compose')" id="tab-compose" class="flex-1 py-3 font-medium border-b-2 border-transparent text-gray-500">
                    Ìï©ÏÑ±
                </button>
            </nav>

            <!-- Ïù¥ÎØ∏ÏßÄ ÏûÖÎ†• ÌÉ≠ -->
            <div id="content-input" class="p-4">
                <!-- ÌååÏùº ÏÑ†ÌÉù -->
                <label class="block w-full p-8 border-2 border-dashed border-gray-300 rounded-lg text-center cursor-pointer hover:border-blue-400 active:bg-gray-50">
                    <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
                    <div class="text-4xl mb-2">üìÅ</div>
                    <div class="text-lg font-medium">Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù</div>
                    <div class="text-sm text-gray-500 mt-1">Ïó¨Îü¨ Ïû• ÏÑ†ÌÉù Í∞ÄÎä•</div>
                </label>

                <!-- Ïù¥ÎØ∏ÏßÄ Í∞§Îü¨Î¶¨ -->
                <div id="imageGallery" class="mt-4 grid grid-cols-2 gap-3"></div>
            </div>

            <!-- Ìé∏Ïßë ÌÉ≠ -->
            <div id="content-edit" class="p-4 hidden">
                <!-- ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                <div class="mb-6">
                    <h3 class="font-bold mb-3">ÌÅ¨Î°≠ ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
                    <div id="cropPreview"></div>
                </div>

                <!-- ÌÅ¨Î°≠ ÏòÅÏó≠ Ï°∞Ï†ï -->
                <div class="mb-6">
                    <h3 class="font-bold mb-3">ÌÅ¨Î°≠ ÏòÅÏó≠ ÏÑ§Ï†ï</h3>
                    
                    <!-- ÏÉÅÎã® -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-600 mb-1 block">ÏÉÅÎã® (%)</label>
                        <input type="range" id="rangeTop" min="0" max="100" value="0" 
                               oninput="updateCropArea('top', this.value)"
                               class="w-full mb-1">
                        <input type="number" id="cropTop" min="0" max="100" value="0" 
                               oninput="updateCropArea('top', this.value)"
                               class="w-full p-2 border rounded-lg text-center">
                    </div>

                    <!-- ÌïòÎã® -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-600 mb-1 block">ÌïòÎã® (%)</label>
                        <input type="range" id="rangeBottom" min="0" max="100" value="0" 
                               oninput="updateCropArea('bottom', this.value)"
                               class="w-full mb-1">
                        <input type="number" id="cropBottom" min="0" max="100" value="0" 
                               oninput="updateCropArea('bottom', this.value)"
                               class="w-full p-2 border rounded-lg text-center">
                    </div>

                    <!-- Ï¢åÏ∏° -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-600 mb-1 block">Ï¢åÏ∏° (%)</label>
                        <input type="range" id="rangeLeft" min="0" max="100" value="0" 
                               oninput="updateCropArea('left', this.value)"
                               class="w-full mb-1">
                        <input type="number" id="cropLeft" min="0" max="100" value="0" 
                               oninput="updateCropArea('left', this.value)"
                               class="w-full p-2 border rounded-lg text-center">
                    </div>

                    <!-- Ïö∞Ï∏° -->
                    <div class="mb-4">
                        <label class="text-sm text-gray-600 mb-1 block">Ïö∞Ï∏° (%)</label>
                        <input type="range" id="rangeRight" min="0" max="100" value="0" 
                               oninput="updateCropArea('right', this.value)"
                               class="w-full mb-1">
                        <input type="number" id="cropRight" min="0" max="100" value="0" 
                               oninput="updateCropArea('right', this.value)"
                               class="w-full p-2 border rounded-lg text-center">
                    </div>

                    <!-- ÌîÑÎ¶¨ÏÖã Ï†ÄÏû• Î≤ÑÌäº -->
                    <button onclick="saveCurrentPreset()" 
                            class="w-full py-2 bg-gray-500 text-white rounded-lg font-medium active:bg-gray-600 mb-4">
                        üíæ ÌòÑÏû¨ ÏÑ§Ï†ï ÌîÑÎ¶¨ÏÖãÏúºÎ°ú Ï†ÄÏû•
                    </button>
                </div>

                <!-- Ï†ÄÏû•Îêú ÌîÑÎ¶¨ÏÖã -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold">Ï†ÄÏû•Îêú ÌîÑÎ¶¨ÏÖã</h3>
                        <button onclick="openPresetManager()" 
                                class="text-xs bg-gray-600 text-white px-3 py-1 rounded active:bg-gray-700">
                            ‚öôÔ∏è Í¥ÄÎ¶¨
                        </button>
                    </div>
                    <div id="savedPresets" class="space-y-2"></div>
                </div>

                <!-- Ïù¥ÎØ∏ÏßÄ Ï†ïÎ≥¥ -->
                <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                    <div class="text-sm font-medium text-blue-700">
                        Ï†ÑÏ≤¥ Ïù¥ÎØ∏ÏßÄ: <span id="imageCount">0</span>Í∞ú
                    </div>
                </div>

                <!-- ÏßÑÌñâÎ•† -->
                <div id="progressBar" class="mb-4 hidden">
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                        <div id="progressFill" class="bg-blue-500 h-3 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                    <div class="text-center text-sm text-gray-600">
                        <span id="progressText">0%</span>
                    </div>
                </div>

                <!-- ÏùºÍ¥Ñ ÌÅ¨Î°≠ Î≤ÑÌäº -->
                <button onclick="startBatchCrop()" id="batchCropButton" 
                        class="w-full py-4 bg-green-500 text-white rounded-lg font-bold text-lg active:bg-green-600 disabled:bg-gray-300"
                        disabled>
                    ‚úÇÔ∏è Ï†ÑÏ≤¥ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Î°≠ÌïòÍ∏∞
                </button>
            </div>

            <!-- Ìï©ÏÑ± ÌÉ≠ -->
            <div id="content-compose" class="p-4 hidden">
                <!-- ÌÅ¨Î°≠ Ìé∏ÏßëÍ∏∞ (Ìï©ÏÑ± ÌÉ≠ ÎÇ¥Î∂Ä - Ïä¨ÎùºÏù¥Îçî Î∞©Ïãù) -->
                <div id="cropEditor" class="hidden mb-6 border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                    <h3 class="font-bold mb-3 text-blue-700">ÌÅ¨Î°≠ ÏòÅÏó≠ ÏàòÏ†ï</h3>
                    
                    <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                    <div class="relative inline-block w-full mb-4">
                        <img id="cropImage" class="max-w-full rounded">
                        <div id="cropOverlay" class="absolute top-0 left-0 w-full h-full pointer-events-none"></div>
                    </div>

                    <!-- Í∞ÑÎã®Ìïú Ïä¨ÎùºÏù¥Îçî Ï°∞Ï†ï -->
                    <div class="space-y-3 mb-4">
                        <div>
                            <label class="text-sm text-gray-700 font-medium">ÏÉÅÎã® (%)</label>
                            <input type="range" id="editRangeTop" min="0" max="100" value="0" 
                                   oninput="updateEditCropArea('top', this.value)"
                                   class="w-full">
                        </div>
                        <div>
                            <label class="text-sm text-gray-700 font-medium">ÌïòÎã® (%)</label>
                            <input type="range" id="editRangeBottom" min="0" max="100" value="0" 
                                   oninput="updateEditCropArea('bottom', this.value)"
                                   class="w-full">
                        </div>
                        <div>
                            <label class="text-sm text-gray-700 font-medium">Ï¢åÏ∏° (%)</label>
                            <input type="range" id="editRangeLeft" min="0" max="100" value="0" 
                                   oninput="updateEditCropArea('left', this.value)"
                                   class="w-full">
                        </div>
                        <div>
                            <label class="text-sm text-gray-700 font-medium">Ïö∞Ï∏° (%)</label>
                            <input type="range" id="editRangeRight" min="0" max="100" value="0" 
                                   oninput="updateEditCropArea('right', this.value)"
                                   class="w-full">
                        </div>
                    </div>

                    <!-- ÌîÑÎ¶¨ÏÖã Î≤ÑÌäº ÏòÅÏó≠ -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-sm text-gray-700 font-medium">ÌÅ¨Î°≠ ÌîÑÎ¶¨ÏÖã</label>
                            <button onclick="saveCurrentEditPreset()" 
                                    class="text-xs bg-gray-500 text-white px-3 py-1 rounded active:bg-gray-600">
                                üíæ Ï†ÄÏû•
                            </button>
                        </div>
                        <div id="editPresetButtons" class="flex gap-2 overflow-x-auto pb-2"></div>
                    </div>

                    <!-- ÏΩîÎ©òÌä∏ ÏûÖÎ†• -->
                    <input type="text" id="commentInput" placeholder="ÏΩîÎ©òÌä∏ Ï∂îÍ∞Ä (ÏÑ†ÌÉùÏÇ¨Ìï≠)" 
                           class="w-full p-3 border rounded-lg mb-3">
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="applyCrop()" class="py-3 bg-blue-500 text-white rounded-lg font-medium active:bg-blue-600">
                            ‚úì ÏàòÏ†ï Ï†ÅÏö©
                        </button>
                        <button onclick="cancelCrop()" class="py-3 text-gray-600 border rounded-lg active:bg-gray-50">
                            Ï∑®ÏÜå
                        </button>
                    </div>
                </div>

                <!-- ÌÅ¨Î°≠Îêú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                <div class="mb-6">
                    <h3 class="font-bold mb-3">ÌÅ¨Î°≠Îêú Ïù¥ÎØ∏ÏßÄ (<span id="croppedCount">0</span>Í∞ú)</h3>
                    <div id="croppedPreview"></div>
                </div>

                <!-- Ìï©ÏÑ± ÏÑ§Ï†ï -->
                <div class="mb-6 space-y-3">
                    <h3 class="font-bold">Ìï©ÏÑ± ÏÑ§Ï†ï</h3>
                    <div>
                        <label class="text-sm text-gray-600">ÏµúÎåÄ ÎÑàÎπÑ (px)</label>
                        <input type="number" id="maxWidth" value="1080" 
                               class="w-full p-2 border rounded-lg mt-1">
                    </div>
                    <div>
                        <label class="text-sm text-gray-600">Ïù¥ÎØ∏ÏßÄ Í∞ÑÍ≤© (px)</label>
                        <input type="number" id="padding" value="10" 
                               class="w-full p-2 border rounded-lg mt-1">
                    </div>
                </div>

                <!-- Ìï©ÏÑ± Î≤ÑÌäº -->
                <button onclick="composeImages()" id="composeButton"
                        class="w-full py-4 bg-purple-500 text-white rounded-lg font-bold text-lg active:bg-purple-600 disabled:bg-gray-300"
                        disabled>
                    üé® Ïù¥ÎØ∏ÏßÄ Ìï©ÏÑ±ÌïòÍ∏∞
                </button>

                <!-- Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                <div id="resultPreview" class="mt-6 hidden">
                    <h3 class="font-bold mb-3">Ìï©ÏÑ± Í≤∞Í≥º</h3>
                    <img id="resultImage" class="w-full rounded-lg shadow-lg mb-4">
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="downloadResult()" 
                                class="py-3 bg-green-500 text-white rounded-lg font-medium active:bg-green-600">
                            üíæ Ï†ÄÏû•
                        </button>
                        <button onclick="shareResult()" 
                                class="py-3 bg-blue-500 text-white rounded-lg font-medium active:bg-blue-600">
                            üì§ Í≥µÏú†
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ÌîÑÎ¶¨ÏÖã Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="presetManager" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-y-auto">
            <div class="p-4 border-b sticky top-0 bg-white">
                <div class="flex justify-between items-center">
                    <h3 class="font-bold text-lg">ÌîÑÎ¶¨ÏÖã Í¥ÄÎ¶¨</h3>
                    <button onclick="closePresetManager()" class="text-2xl text-gray-500 hover:text-gray-700">√ó</button>
                </div>
            </div>
            <div class="p-4">
                <div id="presetManagerList" class="space-y-2"></div>
                <div id="presetManagerEmpty" class="text-center py-8 text-gray-400 hidden">
                    Ï†ÄÏû•Îêú ÌîÑÎ¶¨ÏÖãÏù¥ ÏóÜÏäµÎãàÎã§
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
