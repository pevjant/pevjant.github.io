# 🔍 커밋 이력 분석 보고서

> 작성일: 2025-10-17
> 분석 범위: 초기 커밋부터 현재까지 (약 40개 커밋)

---

## 📊 핵심 문제점 요약

### 1️⃣ **반복적인 문제 해결 실패 - 드래그 기능**

**문제 발생 시점**: 2025-10-17 오후
**관련 커밋**: 7개 이상의 연속된 수정 커밋

```
035cd37 - 추가: 성능 최적화된 드래그 기능 복원
7f232c3 - 버전 업데이트: v2.1.0
cf272bc - 버전 업데이트: v2.2.0
1e77591 - 버전 업데이트: v2.3.0 - 드래그 로직 단순화
b76d8cb - 버전 업데이트: v2.4.0 - Pointer Events로 드래그 단순화/안정화
0728045 - 디버깅 로그 추가: v2.5.0
839e188 - v2.6.0: 드래그 즉시 반응성 개선
```

#### 🔴 근본 원인 분석

1. **명확한 요구사항 부재**
   - 사용자가 원하는 정확한 동작이 명시되지 않음
   - "성능 최적화"라는 추상적인 목표만 제시
   - 실제 문제(지연, 끊김 등)가 구체적으로 정의되지 않음

2. **과도한 기술 변경**
   - mouse/touch 이벤트 → Pointer Events 전환 (v2.4.0)
   - requestAnimationFrame 추가/제거 반복
   - 이벤트 스로틀링 방식 변경 (즉시 반영 → RAF → 하이브리드)
   
3. **테스트 환경 불일치**
   - PC 브라우저에서는 정상 동작
   - 모바일 환경에서의 실제 테스트 부족
   - 터치 이벤트의 특수성 간과

4. **성능 vs 반응성 트레이드오프 미해결**
   ```javascript
   // v2.6.0 최종 해결책 (하이브리드 접근)
   applyBoxStyles();  // 스타일은 즉시 반영
   if (!rafId) rafId = requestAnimationFrame(() => render(false));  // 입력만 스로틀
   ```

---

### 2️⃣ **슬라이더 최대값 제한 문제**

**문제 발생 시점**: 초기 구현부터 존재
**해결 시점**: ca202c6 (2025-10-17 13:19)

#### 🟡 원인 분석

```diff
- <input type="range" id="rangeTop" min="0" max="50" value="0">
+ <input type="range" id="rangeTop" min="0" max="100" value="0">
```

**왜 발생했나?**
1. **초기 설계 오류**: 기획 단계에서 "하단 25%", "하단 30%" 크롭만 고려
2. **확장성 미고려**: 전체 영역 크롭 등 다양한 사용 사례 간과
3. **단순 실수**: 슬라이더 max와 number input max가 불일치 (number는 100, range는 50)

**해결이 늦어진 이유**:
- 다른 기능(드래그) 추가에 집중하느라 기본 기능 개선 누락
- 사용자 피드백 부재로 문제 인지 지연

---

### 3️⃣ **공유 받기(Share Target) 기능 불안정**

**문제 커밋 이력**:
```
1a6ae56 - Fix PWA share target: 아이콘 경로 수정 및 파일 공유 지원 개선
42166a3 - v1.0.2: Critical fix for Android Share Target
79f8b44 - v1.1.0: Fix share data not displaying (CRITICAL FIX)
3240f1b - feat: v1.0.1 - Share Target 기능 복원 및 개선
```

#### 🔴 근본 원인

1. **PWA 아키텍처 이해 부족**
   - Service Worker와 Main Thread 통신 타이밍 이슈
   - postMessage 방식의 한계 미인지
   
2. **Android 특수성 간과**
   - manifest.json 설정 오류 (start_url, orientation 등)
   - MIME type 필터 과다 (image/jpeg, image/png, image/webp, image/gif, video/*)
   
3. **해결 과정에서의 시행착오**
   ```javascript
   // ❌ 실패: postMessage (타이밍 이슈)
   self.clients.get(clientId).then(client => {
     client.postMessage({ type: 'share-data', data });
   });
   
   // ✅ 성공: Cache API (영구 저장)
   const cache = await caches.open('shared-data');
   await cache.put('/shared-data/latest', new Response(JSON.stringify(data)));
   ```

---

## 🎯 왜 문제가 반복되었나?

### 1. **점진적 개선 부재**
- 작은 변경 → 테스트 → 검증 사이클 없음
- 한 번에 여러 변경사항 커밋 (v2.4.0: Pointer Events + 스로틀 + CSS 변경)

### 2. **명확한 성공 기준 부재**
```
❌ "성능 최적화"
❌ "드래그 단순화"
✅ "터치 드래그 시 100ms 이내 반응, 끊김 없음" (구체적 기준)
```

### 3. **테스트 전략 부족**
- PC 개발 환경에서만 테스트
- 실제 모바일 디바이스(Android Chrome) 테스트 누락
- 엣지 케이스 시나리오 검증 부족

### 4. **롤백 메커니즘 부재**
- 문제 발생 시 이전 버전으로 복구하지 않음
- 계속 새로운 해결책 시도 → 문제 누적

---

## 📋 각 문제별 상세 타임라인

### 드래그 기능 변경 이력

| 버전 | 날짜 | 주요 변경 | 결과 |
|------|------|-----------|------|
| v2.1.0 | 10-17 13:25 | 초기 드래그 구현 (mouse/touch) | ⚠️ 성능 문제 |
| v2.2.0 | 10-17 13:30 | RAF 추가 | ⚠️ 지연 발생 |
| v2.3.0 | 10-17 13:45 | 로직 단순화 | ⚠️ 여전히 문제 |
| v2.4.0 | 10-17 14:00 | Pointer Events 전환 | ⚠️ 모바일 터치 이슈 |
| v2.5.0 | 10-17 14:30 | 디버깅 로그 추가 | ℹ️ 문제 진단 |
| v2.6.0 | 10-17 15:00 | 하이브리드 접근 | ✅ 부분 해결 |

**총 소요 시간**: 약 1.5시간 (6번 재시도)

### 공유 받기 기능 변경 이력

| 커밋 | 날짜 | 문제 | 해결 시도 | 결과 |
|------|------|------|-----------|------|
| 1a6ae56 | 10-16 | 아이콘 경로 오류 | 경로 수정 | ⚠️ 여전히 안됨 |
| 42166a3 | 10-16 14:45 | start_url 오류 | manifest.json 수정 | ⚠️ 데이터 미표시 |
| 79f8b44 | 10-16 14:56 | postMessage 타이밍 | Cache API 사용 | ✅ 해결 |

**총 소요 시간**: 약 2시간 (3번 재시도)

---

## 🔑 핵심 교훈

### 1. **요구사항 명확화의 중요성**

```markdown
# ❌ 나쁜 요구사항
"드래그 성능 개선해줘"

# ✅ 좋은 요구사항
"모바일(Android Chrome)에서 크롭 영역 드래그 시:
- 터치 후 100ms 이내 반응
- 드래그 중 끊김 없이 부드러운 움직임
- 슬라이더 입력값도 실시간 업데이트
- 페이지 스크롤 방지"
```

### 2. **점진적 개선 원칙**

```bash
# ❌ 한 번에 모든 것 변경
git commit -m "드래그 전체 리팩토링 + Pointer Events + RAF + CSS"

# ✅ 단계별 변경
git commit -m "Step 1: touch-action: none 추가"
# 테스트 → 검증
git commit -m "Step 2: Pointer Events로 전환"
# 테스트 → 검증
git commit -m "Step 3: RAF 최적화"
```

### 3. **실제 환경 테스트**

- 개발 환경 ≠ 운영 환경
- PC 브라우저 ≠ 모바일 브라우저
- **반드시 실제 디바이스에서 테스트**

### 4. **기술 부채 관리**

현재 코드의 기술 부채:
```javascript
// app.js 라인 330-500: 중복 코드
// setupPreviewDrag()와 setupEditDrag()가 거의 동일
// → 통합 가능 (DRY 원칙 위반)

// app.html: 슬라이더 중복
// 편집 탭과 합성 탭의 슬라이더 코드 중복
// → 컴포넌트화 필요
```

---

## 💡 개선 제안

### 1. **개발 프로세스 개선**

```yaml
단계:
  1. 요구사항 명확화:
    - 구체적인 동작 정의
    - 성공 기준 수립
    - 엣지 케이스 정의
  
  2. 설계:
    - 기술 선택 근거 문서화
    - 예상 리스크 식별
  
  3. 구현:
    - 작은 단위로 커밋
    - 각 커밋마다 테스트
  
  4. 검증:
    - PC + 모바일 환경 테스트
    - 성능 측정
  
  5. 문서화:
    - 변경 사항 기록
    - 알려진 이슈 명시
```

### 2. **코드 개선 우선순위**

**High Priority**:
1. ✅ 슬라이더 최대값 수정 (완료)
2. ⚠️ 드래그 코드 중복 제거
3. ⚠️ 모바일 테스트 자동화

**Medium Priority**:
1. PWA 매니페스트 검증 자동화
2. 에러 핸들링 강화
3. 성능 모니터링 추가

**Low Priority**:
1. TypeScript 마이그레이션 고려
2. 유닛 테스트 추가
3. CI/CD 파이프라인 구축

### 3. **테스트 체크리스트**

```markdown
# 기능 변경 시 필수 체크

## 환경
- [ ] Chrome Desktop (Windows/Mac/Linux)
- [ ] Chrome Mobile (Android)
- [ ] Safari Mobile (iOS)

## 시나리오
- [ ] 이미지 업로드
- [ ] 공유하기로 이미지 받기
- [ ] 크롭 영역 드래그
- [ ] 크롭 영역 리사이즈
- [ ] 슬라이더 조작
- [ ] 일괄 크롭
- [ ] 이미지 합성
- [ ] 결과 다운로드
- [ ] 결과 공유하기

## 성능
- [ ] 드래그 응답 시간 < 100ms
- [ ] 합성 시간 (4장 기준) < 2초
- [ ] 메모리 누수 없음
```

---

## 📈 프로젝트 성숙도 평가

| 항목 | 현재 상태 | 목표 | 개선 필요도 |
|------|-----------|------|-------------|
| 기능 완성도 | 85% | 95% | ⭐⭐ |
| 코드 품질 | 60% | 80% | ⭐⭐⭐ |
| 테스트 커버리지 | 0% | 70% | ⭐⭐⭐⭐⭐ |
| 문서화 | 70% | 90% | ⭐⭐ |
| 사용자 경험 | 75% | 95% | ⭐⭐⭐ |

---

## 🎬 결론

### 문제의 핵심

1. **요구사항 불명확** → 여러 번 시행착오
2. **테스트 부족** → 배포 후 문제 발견
3. **기술 부채 누적** → 유지보수 어려움

### 해결 방향

1. **즉시 개선**:
   - 모바일 실기기 테스트 환경 구축
   - 중복 코드 리팩토링
   
2. **단기 개선** (1주):
   - 테스트 체크리스트 적용
   - 성능 모니터링 추가
   
3. **장기 개선** (1달):
   - 자동화 테스트 구축
   - CI/CD 파이프라인

---

**작성자**: GitHub Copilot  
**분석 기간**: 2시간  
**분석 커밋 수**: 40개  
**발견된 주요 이슈**: 3개 (드래그, 슬라이더, 공유받기)
